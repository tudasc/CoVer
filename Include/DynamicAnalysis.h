#pragma once

#include "stdint.h"

/*
 * This is a simplified version of the ContractTree,
 * using c-native types.
 * This representation is generated by the instrumentation pass
 * for use with dynamic tools.
 */

struct Tag_t {
    const char* tag;
    int64_t param;
};

struct TagsMap_t {
    void** functions; // List of function pointers
    Tag_t* tags; // List of tags (matching above funcptr)
    int64_t count;
};

// Number must match those defined in ContractTree.hpp!
enum ParamAccess : int64_t { NORMAL = 0, DEREF = 1, ADDROF = 2 };
struct CallParam_t {
    int64_t callP;
    int64_t callPisTagVar; // Read as bool
    int64_t contrP;
    ParamAccess accType;
};

struct CallOp_t {
    void* target_function;
    const char* function_name;
    CallParam_t* params;
    int64_t num_params;
};
struct CallTagOp_t {
    const char* target_tag;
    CallParam_t* params;
    int64_t num_params;
};

// Number must match those defined in enums in ContractTree.hpp (operation + connective)!
enum ContractConnective : int64_t { UNARY_READ = 0, UNARY_WRITE = 1, UNARY_CALL = 2, UNARY_CALLTAG = 3, UNARY_RELEASE = 4, AND = 5, OR = 6, XOR = 7 };
struct ContractFormula_t {
    ContractFormula_t* children;
    int64_t num_children;
    ContractConnective conn;
    const char* msg;
    void** data; // Only filled if conn == UNARY. Pointer to corresponding operation struct.
};

struct Contract_t {
    ContractFormula_t* precondition;
    ContractFormula_t* postcondition;
    void* function;
    const char* function_name;
};

struct ContractDB_t {
    Contract_t* contracts;
    int64_t num_contracts;
    TagsMap_t tags;
};
